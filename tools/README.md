# Tools

This section contains information and discussions about the tools used in this
repository. When I began working on this code and documentation repository, I
needed a set of tools to allow code to be written and tested. My requirements
were:

1. A 6502 assembler that supports the W65C02S, flexible macros, include files
and could create linkable objects.
2. A linker that could accepts linkable object and library files and a system
map or configuration
3. A simulation tool that would allow me to run automated tests on my code to
verify that it was doing what I thought it ought to do.

To this end, I have chosen the cc65 tool chain because it checks off all the
points I require and it was the first usable tool set that I found. The choice
of tool chain may change at some point.

Let's take a closer look at the development tools I have managed to find
so far:

## cc65

cc65 is a cross development package for 65(C)02 systems initially released
in April 26, 1999. It supports many types of 6502 based systems and it is
open-sourced and free! A configuration file allowing it to target the
Commander X 16 is currently under development.

The cc65 compiler repository may be found on [**github**](https://cc65.github.io/).
This set of tools is composed of several component programs that are accessed
via the command line or make script. For a free software development product,
it is truly amazing. Here's what's included:

* ar65 is an archiver for object files generated by ca65. It can create
archives, add or remove modules from archives, and extract modules from
existing archives.
* **ca65** is a powerful macro assembler for the 6502, 65C02, and 65816 CPUs.
It is used as a companion assembler for the cc65 cross compiler, but it may
also be used as a standalone product.
* cc65 is a C compiler for 6502 targets. It supports several 6502 based home
computers like the Commodore and Atari machines, but it is easily retargetable.
* chrcvt65 is the vector font converter. It is able to convert a foreign font
into the native format.
* cl65 is the compile & link utility for cc65, the 6502 C compiler. It was
designed as a smart front-end for cc65, ca65, co65, ld65.
* co65 is an object file conversion utility. It converts o65 object files into
the native object file format used by the cc65 tool chain.
* da65 is a 6502/65C02 disassembler that supports user-supplied information
about its input data, for better results. The output can be fed into the ca65,
macro assembler.
* grc65 is a GEOS resource compiler that can create GEOS headers and menus for
cc65-compiled programs.
* **ld65** is a linker that combines object files into an executable file.
ld65 is highly configurable and uses configuration files for high flexibility.
* od65 is the object file dump utility. It is able to output most parts of
ca65-generated object files in readable form.
* **sim65** is a simulator for 6502 and 65C02 CPUs. It allows testing of
target independent code.
* sp65 is a sprite and bitmap utility. It is used to convert graphics and
bitmaps into formats supported by the target machine.

The compiler is accompanied with extensive documentation of all aspects of
the tools and their use.

As mentioned before, the cc65 tools were a excellent match for my
requirements. Not only was the macro assembler and linker full featured, it
included a simulator that allowed me to develop automated test tools. These
tools may be found in the [**t65**](../t65) folder.

In the mean time, there are a few areas where a little extra explanation
could come in handy, especially for those less familiar with the cc65 compiler
tool set.

### File Names

Different operating systems have different restrictions on the characters
allowed in the name of a file. To avoid grief, the most crucial rule is to
avoid the use of file names containing embedded spaces or punctuation. To
make file names easier to read and handle it would be a good idea to choose
file names that consist of lower case letters or numbers and words joined
by underscore "_" characters.

### The ca65 Macro-Assembler

The ca65 macro-assembler is accessed via the command line. The syntax of that
command line is simple:

    ca65 [options] file

Here are a few selected options

    -D name[=value]    Define a symbol.
    -I dir             Set an include directory search path.
    -U                 Mark unresolved symbols as import.
    -h                 Display help on the usage and available options.
    -i                 Ignore case of symbols.
    -l name            Create a listing file if assembly was OK.
    -o name            Name the output file.

You can also refer to the documentation for more complete information.

#### Using include files in ca65:

A very useful feature of the ca65 assembler is the ability to include files.
When this is done, the text if the included file is essentially read into
the current file at the point of inclusion. This allow the easy use of
definitions, macros, and other resources from other sources.

To use include files they need to use the include statement:

    .include "my_file.i65"

The include statement can also include path navigation information to allow
the assembler to find the file.

    .include "../utilities/assist_16/set_16.i65"

This example uses a relative path. The use of absolute paths are discouraged
since this makes it far more difficult to build the code an another machine.
Note the use of forward slash characters even though this example was run
under Windows which normally uses the back-slash character for file path
navigation.

To actually perform the include step, the assembler program must first be able
to locate that file. There are a number of places that included files may be
stored in order to make this work. They are:

* In the same folder as the assembler file(s) that use it.
* Via the path specified in the include statement.
* In a folder named in a "-I <folder>" option on the ca65 command line.
* In a folder listed in the environment variable CA65_INC.
* In a folder named "asminc" of the folder defined in the environment variable
CC65_HOME. This folder should be reserved for files that are part of the cc65
compiler tool set.

## The ld65 Linker

The ld65 linker is accessed via the command line. The syntax of that command
line is simple:

    ld65 [options] module ...

Here are a few selected options

    -C name            Use linker config file
    -D sym=val         Define a symbol
    -L path            Specify a library search path
    -h                 Display help on the usage and available options.
    -o name            Name the default output file
    -t sys             Set the target system
    --cfg-path path    Specify a config file search path
    --config name      Use linker config file
    --lib file         Link this library
    --lib-path path    Specify a library search path
    --mapfile name     Create a map file
    --obj file         Link this object file
    --obj-path path    Specify an object file search path

### A little about linkers

Linkers get no respect. I used to think that any assembler should be able to
output directly to a binary file for direct execution or an Intel Hex or
Motorola S-record file for burning into an EPROM chip. Linkers were just
another step to go wrong.

I now know that this is not the case. Linkers bring a lot to the table that
make them so very useful. For starters they:

* Allow multiple object files to be linked together allowing code to be
written in a modular fashion.
* Can search libraries extracting the needed code while omitting code that is
not needed.
* Organize memory layout based on a system configuration that describes the
target system.
* Allows output linked code to multiple files for systems with more than one
memory device to be programmed. It can even discard memory regions that are to
contain uninitialized data.

Time and time again, I have found that a disciplined, modular approach leads
to success and that taking short-cuts and hacking leads to an unworkable mess.
Linkers make the modular apporach work with a minimum of fuss and ceremony.

### Using object files with ld65

When object files are specified, the linker will search the following places
looking for the specified files:

* The current directory.
* Any directory added with the --obj-path option on the command line.
* The value of the environment variable LD65_OBJ if it is defined.
*A subdirectory named obj of the directory defined in the environment variable
CC65_HOME, if it is defined.

### Using library files with ld65

wip

### Using config files with ld65

wip

## File Extensions

In order to avoid conflict with host file types, the following file extension
conventions have been used throughout this repository.

Extension | Use
----------|----------------------------------------------------
*.a65     | Assembler Source File.
*.i65     | Assembler Include File.
*.md      | Documentation using GitHub style markdown formatting.
t65*.a65  | Unit Test Assembler Source File.
*.cfg     | An ld65 Linker Configuration File.
others    | To be determined.

wip

## Git and GitHub

Git is a free and open source distributed version control system designed to
handle everything from small to very large projects with speed and efficiency.

That's what the git web site says. I say git is awesome!
I say git is essential!

If you write code, you should track changes to that code. Git does _that_ for
free. If you write code, you should back up your code to a safe place. GitHub
does _that_ for free.

No excuses, get [**git**](https://git-scm.com/) and sign up for
[**GitHub**](https://github.com/).

Full disclosure, yes GitHub is now owned by Microsoft. So far they have made
several improvements like allowing for free private repositories. Many have
a long history of feuding with this company. Do not let past bitterness
blind you in the present.

I have no affiliation in any way with Git, GitHub, Microsoft or any of their
subsidiaries, partners, or associates. And now for some hillbilly git humor:

    git -r done

## Notepad++

Another, and entirely optional, component of my toolset is the
[Notepad++](https://notepad-plus-plus.org/)
editor. This program supports multi-tab edit with syntax highlighting. It also
allows effortless handling of the various line endings used in Windows, Linux,
Unix, and the Mac. It's also easy-to-use and free! You may prefer another
editor and that's OK. Go with what makes you happy.

_todo_ Create a configuration style for the cc65 assembly language so that it
looks nice while being edited.
