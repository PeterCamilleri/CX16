# Tools

This section contains information and discussions about the tools used in this
repository. When I began working on this code and documentation repository, I
needed a set of tools to allow code to be written and tested. My requirements
were:

1. A 6502 assembler that supports the W65C02S, flexible macros, include files
and could create linkable objects.
2. A linker that could accepts linkable object and library files and a system
map or configuration
3. A simulation tool that would allow me to run automated tests on my code to
verify that it was doing what I thought it ought to do.

To this end, I have chosen the cc65 tool chain because it checks off all the
points I require and it was the first usable tool set that I found. The choice
of tool chain may change at some point.

Let's take a closer look at the development tools I have managed to find
so far:

## cc65

The cc65 compiler repository may be found on [**github**](https://cc65.github.io/).
This set of tools is composed of several component programs that are accessed
via the command line or make script. For a free software development product,
it is truly amazing. Here's what's included:

* ar65 is an archiver for object files generated by ca65. It can create archives, add or remove modules from archives, and extract modules from existing archives.
* **ca65** is a powerful macro assembler for the 6502, 65C02, and 65816 CPUs. It is used as a companion assembler for the cc65 cross compiler, but it may also be used as a standalone product.
* cc65 is a C compiler for 6502 targets. It supports several 6502 based home computers like the Commodore and Atari machines, but it is easily retargetable.
* chrcvt65 is the vector font converter. It is able to convert a foreign font into the native format.
* cl65 is the compile & link utility for cc65, the 6502 C compiler. It was designed as a smart front-end for cc65, ca65, co65, ld65.
* co65 is an object file conversion utility. It converts o65 object files into the native object file format used by the cc65 tool chain.
* da65 is a 6502/65C02 disassembler that supports user-supplied information about its input data, for better results. The output can be fed into the ca65, macro assembler.
* grc65 is a GEOS resource compiler that can create GEOS headers and menus for cc65-compiled programs.
* **ld65** is a linker that combines object files into an executable file. ld65 is highly configurable and uses configuration files for high flexibility.
* od65 is the object file dump utility. It is able to output most parts of ca65-generated object files in readable form.
* **sim65** is a simulator for 6502 and 65C02 CPUs. It allows testing of target independent code.
* sp65 is a sprite and bitmap utility. It is used to convert graphics and bitmaps into formats supported by the target machine.

As mentioned before, the cc65 tools were a excellent match for my
requirements. Not only was the macro assembler and linker full featured, it
included a simulator that allowed me to develop automated test tools. These
tools may be found in the [**t65**](../t65) folder.

In the mean time, there are a few areas where a little extra explanation would
come in handy, especially for those less familiar with compiler tool sets.

### File Names

Different operating systems have different restrictions on the characters
allowed in the name of a file. To avoid grief, the most crucial rule is to
avoid the use of file names containing embedded spaces or punctuation. To
make file names easier to read and handle it would be a good idea to choose
file names that consist of lower case letters or numbers and words joined
by underscore "_" characters.

wip

The initial work on the CX16 project will be done with the [cc65]
tool chain. There are many reasons that I have made this my choice. The
assembler (ca65) supports macros, the 65C02 (among others) and it comes with
a linker (ld65) which breaks the tyranny of absolute object code and the sim65
simulator that allows me to test my code easily. Besides all of that, it's
open-sourced and free!

See the t65 folder's readme file for more information on testing the code as
well as the steps that need to be taken to get around a couple of glitches I
encountered along the way.

### Using include files in assembler:

A very useful feature of the assembler is the ability to include files. When
this is done, the text if the included file is essentially read into the
current file at the point of inclusion. This allow the easy use of definitions,
macros, and other resources from other sources.

To use include files they need to use the include statement:

    .include "my_file.i65"

The include statement can also include pathing information to allow the
assembler to find the file. Note the use of forward slash characters even
though this example was run under Windows which normally uses the back-slash
character for file pathing.

    .include "../utilities/assist_16/set_16.i65"

This example uses a relative path. The use of absolute paths are discouraged
since this makes it far more difficult to build the code an another machine.

To actually perform the include step, the assembler program must first be able
to locate that file. There are a number of places that include files may exist
in order to make this work. They are:

* In the same folder as the file(s) that use it.
* Via the path specified in the include statement.
* In a folder named in a "-I <folder>" option on the command line.
* In a folder listed in the environment variable CA65_INC.
* In a folder named "asminc" of the folder defined in the environment variable
CC65_HOME.

*Needs a lot of rework to make sense*

To clarify, assembler source files do the actual work of creating the program.
That is, they contain the variables and code that make up the actual program.
Include files are used to define the entry points, symbols, and macros that
are needed for one assembler source file to utilize another one. They should
**never** generate code or variables. Why? An include file may be included by
many assembler files. Any created entities (code or variables) will be created
multiple times leading to a linker error or "unexpected" results when run.

## File Extensions

Initially, the following file extensions are used in this repository:

Extension | Use
----------|----------------------------------------------------
.a65      | Assembler Source File. Non standard extension to avoid confusion with host files.
.i65      | Assembler Include File. Non standard extension to avoid confusion with host files.
.md       | Documentation using GitHub markdown formatting.
others    | To be determined.

## Notepad++

Another, and entirely optional, component of my toolset is the [Notepad++](https://notepad-plus-plus.org/)
editor. This program supports multi-tab edit with syntax highlighting. It also
allows effortless handling of the various line endings used in Windows, Linux,
Unix, and the Mac. It's also easy-to-use and free! You may prefer another
editor and that's OK. Go with what makes you happy.

_todo_ Create a configuration style for the cc65 assembly language so that it
looks nice while being edited.
