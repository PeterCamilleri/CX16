; SWEET-16 - The APPLE-II Pseudo Machine Interpreter - Header File
; Copyright (C) 1977 APPLE COMPUTER, INC -- All  Rights Reserved
; S. WOZNIAK
; Original code courtesy of: http://www.6502.org/source/interpreters/sweet16.htm
; Ported to ca65 for the Commander X 16 project by Peter Camilleri

.ifndef sweet_16_included
  .fatal "Must include sweet_16.i65 or sweet_16.a65 first"
.endif

.ifndef sweet_16_test_included
sweet_16_test_included = 1

; Exit tests and return success!
.macro sw16_tests_pass
  .if (.cpu .bitand CPU_ISET_SWEET16) = 0
    .fatal "Must be in Sweet-16 mode to use sw16_tests macros"
  .endif

  .byte $0F
  .byte $00
.endmacro

; Exit tests and return an error code :-(
.macro sw16_tests_fail err_code
  .ifconst err_code
    .if (err_code < 2) || (err_code > 255)
      .fatal "Invalid error code. Allowed values 2..255"
    .endif

    .if (.cpu .bitand CPU_ISET_SWEET16) = 0
      .fatal "Must be in Sweet-16 mode to use sw16_tests macros"
    .endif

    .byte $0F
    .byte err_code
  .else
    .fatal "Error code must be a constant"
  .endif
.endmacro

; Exit tests and return an error code if the last result is not zero (ne)
.macro sw16_fail_ne err_code
  .local no_error
  bnz no_error
  sw16_tests_fail err_code
no_error:
.endmacro



.endif
